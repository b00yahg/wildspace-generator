<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wildspace Generator</title>
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Space+Mono&display=swap');

    body {
            font-family: 'Space Mono', monospace;
            background-color: #0a0e1798;
            color: #e0e0e0;
            background-image: 
                url('https://wallpapers.com/images/featured/rainbow-galaxy-okqebhvadd597yqv.jpg'),
                radial-gradient(circle at center, #1a2639 0%, #0a0e17 100%);
            background-blend-mode: overlay;
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }

    .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
    }

    h1 {
        font-family: 'Orbitron', sans-serif;
        color: #ffd700;
        text-align: center;
        font-size: 2.5em;
        text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        margin-bottom: 30px;
    }

    .control-group {
        background-color: rgba(26, 38, 57, 0.7);
        border: 1px solid #4a5d7e;
        border-radius: 5px;
        padding: 15px;
        margin-bottom: 20px;
    }

    label {
        display: inline-block;
        width: 150px;
        color: #ffd700;
        font-weight: bold;
    }

    select, input[type="number"] {
        width: 200px;
        padding: 5px;
        background-color: #0a0e17;
        border: 1px solid #4a5d7e;
        color: #e0e0e0;
        font-family: 'Space Mono', monospace;
    }

    button {
        background-color: #1a2639;
        color: #ffd700;
        border: 2px solid #ffd700;
        border-radius: 5px;
        padding: 10px 20px;
        font-size: 16px;
        font-family: 'Orbitron', sans-serif;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-right: 10px;
    }

    button:hover {
        background-color: #ffd700;
        color: #1a2639;
    }

    button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    #output {
        background-color: rgba(26, 38, 57, 0.7);
        border: 1px solid #4a5d7e;
        border-radius: 5px;
        padding: 20px;
        margin-top: 20px;
        font-family: 'Space Mono', monospace;
        white-space: pre-wrap;
        word-wrap: break-word;
        line-height: 1.8;
    }

    .planet {
        border: 1px solid #4a5d7e;
        border-radius: 5px;
        padding: 15px;
        margin-top: 15px;
        background-color: rgba(10, 14, 23, 0.7);
    }

    .planet-name {
        font-weight: bold;
        color: #ffd700;
        font-size: 1.2em;
        font-family: 'Orbitron', sans-serif;
    }

    .characteristic {
        margin-left: 20px;
        padding: 5px 0;
    }

    .reroll-btn {
        background-color: #4a5d7e;
        color: #ffd700;
        border: none;
        border-radius: 3px;
        padding: 2px 5px;
        font-size: 12px;
        cursor: pointer;
        transition: background-color 0.3s;
        margin-left: 5px;
    }

    .reroll-btn:hover {
        background-color: #ffd700;
        color: #4a5d7e;
    }

    .tooltip {
        position: relative;
        border-bottom: 1px dotted #ffd700;
        cursor: help;
    }

    .tooltip:before {
        content: attr(data-tooltip);
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        padding: 8px;
        background-color: #1a2639;
        color: #ffd700;
        border: 1px solid #ffd700;
        border-radius: 5px;
        white-space: nowrap;
        visibility: hidden;
        opacity: 0;
        transition: opacity 0.3s;
        font-size: 0.9em;
        z-index: 1;
    }

    .tooltip:hover:before {
        visibility: visible;
        opacity: 1;
    }

    @keyframes starTwinkle {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.2; }
    }

    .star {
        position: fixed;
        width: 2px;
        height: 2px;
        background-color: #ffffff;
        border-radius: 50%;
    }

    .star:nth-child(3n) {
        animation: starTwinkle 3s infinite;
    }

    .star:nth-child(3n+1) {
        animation: starTwinkle 4s infinite;
    }

    .star:nth-child(3n+2) {
        animation: starTwinkle 5s infinite;
    }

    #svgContainer {
        width: 100%;
        max-width: 600px;
        margin: 20px auto;
        background-color: rgba(26, 38, 57, 0.7);
        border: 1px solid #4a5d7e;
        border-radius: 5px;
    }
    </style>
</head>
<body>
    <div class="container">
        <h1>Spelljammer Crystal Sphere Generator</h1>
        <div class="control-group">
            <label for="systemType">System Type:</label>
            <select id="systemType">
                <option value="random">Random</option>
                <option value="standard">Standard</option>
                <option value="special">Special</option>
            </select>
        </div>
        <div class="control-group">
            <label for="planetCount">Number of Planets:</label>
            <input type="number" id="planetCount" min="0" max="20">
            <span>(Leave blank for random)</span>
        </div>
        <button id="generate">Generate Crystal Sphere</button>
        <button id="copy">Copy to Clipboard</button>
        <button id="download">Download Sphere TXT</button>
        <div id="svgContainer"></div>
        <div id="output"></div>
    </div>

    <script>
        function rollDice(sides) {
            return Math.floor(Math.random() * sides) + 1;
        }
        
        function rollPercentile() {
            return rollDice(100);
        }
        
        function generateSphereName() {
            const prefixes = [
                'Aether', 'Arcane', 'Astral', 'Aurora', 'Celestial', 'Chaos', 'Chromatic', 'Cosmic', 'Crystal', 'Cyclic',
                'Dragon', 'Dream', 'Echo', 'Eldritch', 'Elemental', 'Empyrean', 'Enchanted', 'Ethereal', 'Fae', 'Flux',
                'Galactic', 'Gossamer', 'Grey', 'Harmonic', 'Helios', 'Hyper', 'Infinite', 'Intrepid', 'Labyrinth', 'Limbo',
                'Lunar', 'Mage', 'Maelstrom', 'Mirage', 'Mist', 'Mystic', 'Nebula', 'Nether', 'Nova', 'Null',
                'Oblivion', 'Occult', 'Omen', 'Opal', 'Oracle', 'Outer', 'Phantom', 'Phase', 'Planar', 'Prism',
                'Psychic', 'Quantum', 'Quasar', 'Radiant', 'Realm', 'Rift', 'Rune', 'Sanguine', 'Sapphire', 'Seraph',
                'Shadow', 'Sidereal', 'Sigil', 'Silent', 'Silver', 'Solar', 'Spectral', 'Spiral', 'Star', 'Stellar',
                'Storm', 'Temporal', 'Tenebrous', 'Twilight', 'Umbral', 'Veil', 'Void', 'Vortex', 'Warp', 'Wild',
                'Wisp', 'Wonder', 'Wraith', 'Xeno', 'Zephyr', 'Zodiac', 'Abyssal', 'Adamant', 'Amber', 'Anomaly',
                'Argent', 'Baroque', 'Beryl', 'Cerulean', 'Crimson', 'Ebon', 'Enigma', 'Gossamer', 'Halcyon', 'Indigo',
                'Kaleidoscope', 'Labyrinth', 'Mercurial', 'Nexus', 'Obsidian', 'Paradox', 'Quicksilver', 'Rhapsody', 'Singularity', 'Tesseract',
                'Umbra', 'Vermilion', 'Whispering', 'Xenon', 'Yttrium', 'Zircon', 'Apeiron', 'Biosphere', 'Chthonic', 'Diaphanous',
                'Effervescent', 'Fractal', 'Gossamer', 'Halcyon', 'Iridescent', 'Jubilant', 'Kinetic', 'Luminous', 'Mellifluous', 'Nebulous',
                'Opulent', 'Phantasmagoric', 'Quintessential', 'Resplendent', 'Scintillating', 'Tremulous', 'Ubiquitous', 'Vivacious', 'Wondrous', 'Xenolithic',
                'Yggdrasil', 'Zenith', 'Aberrant', 'Bifurcated', 'Cataclysmic', 'Dimensional', 'Entropic', 'Fulminating', 'Gyroscopic', 'Heliotropic',
                'Incandescent', 'Juxtaposed', 'Kirlian', 'Lithospheric', 'Metamorphic', 'Numinous', 'Oscillating', 'Prismatic', 'Quixotic', 'Resonant',
                'Symbiotic', 'Thaumaturgic', 'Undulating', 'Verdant', 'Waveform', 'Xenomorphic', 'Yin-Yang', 'Zymurgical', 'Aethereal', 'Bioluminescent',
                'Chromodynamic', 'Draconic', 'Ecliptic', 'Fermenting', 'Geomantic', 'Holographic', 'Ionospheric', 'Kaleidoscopic', 'Levitating', 'Mnemonic',
                'Necromantic', 'Omniscient', 'Photonic', 'Quantum-Entangled', 'Relativistic', 'Sempiternal', 'Tachyonic', 'Ultradimensional', 'Vorticial', 'Wormhole'
            ];
            
            let name = prefixes[Math.floor(Math.random() * prefixes.length)];
            if (Math.random() < 0.4) {
                name += prefixes[Math.floor(Math.random() * prefixes.length)];
            }
            name += 'space';
            return name;
        }
        
        function generatePlanetName() {
            const mythNames = [
                'Zeus', 'Athena', 'Apollo', 'Artemis', 'Hera', 'Poseidon', 'Hades', 'Demeter', 'Ares', 'Aphrodite',
                'Hephaestus', 'Hermes', 'Dionysus', 'Thor', 'Odin', 'Freya', 'Loki', 'Isis', 'Osiris', 'Ra',
                'Anubis', 'Quetzalcoatl', 'Tlaloc', 'Inti', 'Viracocha', 'Shiva', 'Vishnu', 'Brahma', 'Kali', 'Ganesha',
                'Amaterasu', 'Susanoo', 'Tsukuyomi', 'Izanagi', 'Izanami', 'Huitzilopochtli', 'Tezcatlipoca', 'Xipe Totec', 'Ehecatl', 'Tlaloc',
                'Anu', 'Enlil', 'Enki', 'Inanna', 'Utu', 'Marduk', 'Tiamat', 'Baal', 'Astarte', 'Dagon',
                'Cthulhu', 'Azathoth', 'Nyarlathotep', 'Yog-Sothoth', 'Shub-Niggurath', 'Hastur', 'Dagon', 'Yig', 'Mordiggian', 'Tsathoggua',
                'Orunmila', 'Oshun', 'Shango', 'Yemoja', 'Ogun', 'Eshu', 'Oya', 'Obatala', 'BabalÃº-AyÃ©', 'Aganju',
                'Ahura Mazda', 'Angra Mainyu', 'Mithra', 'Anahita', 'Zurvan', 'Vayu', 'Atar', 'Verethragna', 'Rashnu', 'Sraosha',
                'Dagda', 'Brigid', 'Lugh', 'Morrigan', 'Cernunnos', 'Danu', 'Aengus', 'ManannÃ¡n', 'Taranis', 'Epona',
                'Perun', 'Veles', 'Svarog', 'MokoÅ¡', 'Jarilo', 'DaÅ¾bog', 'Stribog', 'Simargl', 'Hors', 'Lada'
            ];
            const syllables = ['ar', 'en', 'ir', 'or', 'ur', 'an', 'in', 'on', 'un', 'el', 'il', 'ol', 'ul', 'ae', 'ia', 'ei', 'ou', 'au', 'eo', 'io', 
                               'zy', 'xy', 'ov', 'ax', 'ex', 'ix', 'ox', 'ux', 'az', 'ez', 'iz', 'oz', 'uz', 'yl', 'yr', 'ys', 'yth', 'yn', 'ym',
                               'ae', 'ai', 'ao', 'au', 'ea', 'ee', 'ei', 'eo', 'eu', 'ia', 'ie', 'io', 'iu', 'oa', 'oe', 'oi', 'oo', 'ou', 'ua', 'ue',
                               'qui', 'qua', 'quo', 'que', 'quu', 'xa', 'xe', 'xi', 'xo', 'xu', 'za', 'ze', 'zi', 'zo', 'zu', 'pha', 'phe', 'phi', 'pho', 'phu'];
            const suffixes = ['ius', 'or', 'ax', 'on', 'eron', 'aris', 'oria', 'ium', 'ara', 'ix', 'oth', 'eth', 'ys', 'os', 'ian', 'eon', 'aris', 'oria', 'ium', 'ara', 
                              'yn', 'yr', 'yx', 'zar', 'zor', 'xor', 'xar', 'nova', 'proxima', 'prime', 'major', 'minor', 'maximus', 'minimus', 'superior', 'inferior',
                              'alpha', 'beta', 'gamma', 'delta', 'epsilon', 'zeta', 'eta', 'theta', 'iota', 'kappa', 'lambda', 'mu', 'nu', 'xi', 'omicron',
                              'tron', 'thon', 'gon', 'cor', 'tor', 'mor', 'bor', 'for', 'nor', 'sor', 'vor', 'zor', 'quor', 'phor', 'chor'];
            const prefixes = ['New ', 'Old ', 'Greater ', 'Lesser ', 'Alpha ', 'Beta ', 'Gamma ', 'Delta ', 'Omega ', 'Neo ', 'Magna ', 'Ultra ', 'Hyper ',
                              'Quantum ', 'Cyber ', 'Astro ', 'Cosmo ', 'Xeno ', 'Exo ', 'Meta ', 'Para ', 'Proto ', 'Pseudo ', 'Quasi ', 'Semi '];
            const wildCards = [
                'Echomyst', 'Voidheart', 'Chromashift', 'Quantumfold', 'Nebulon', 'Stellaris Prime', 'Vortexia', 'Zephyria', 'Novaforge', 'Lumina',
                'Shadowrift', 'Prismatica', 'Ethermist', 'Chronos Major', 'Xenora', 'Bioforge', 'Psionica', 'Halcyonia', 'Quasaria', 'Enigma',
                'Cosmogon', 'Astralith', 'Nexulon', 'Vortexar', 'Quantumia', 'Nebulox', 'Stellanova', 'Chronosphere', 'Aetherium', 'Galaxium',
                'Novacron', 'Celestialis', 'Cosmodrome', 'Astropolis', 'Xenosphere', 'Etheria', 'Luminos', 'Nebularis', 'Voidscape', 'Chronopolis',
                'Helioplex', 'Quantavore', 'Cosmopolis', 'Astralis', 'Novalith', 'Stellarum', 'Voidweaver', 'Chronoshift', 'Etherscape', 'Galaxara',
                'Novalis', 'Celesticon', 'Cosmara', 'Astrovar', 'Xenolix', 'Etheron', 'Luminara', 'Nebulix', 'Voidar', 'Chronomicon'
            ];
            
            if (Math.random() < 0.25) {
                return wildCards[Math.floor(Math.random() * wildCards.length)];
            } else if (Math.random() < 0.5) {
                return mythNames[Math.floor(Math.random() * mythNames.length)];
            } else {
                let name = '';
                if (Math.random() < 0.3) {
                    name += prefixes[Math.floor(Math.random() * prefixes.length)];
                }
                name += syllables[Math.floor(Math.random() * syllables.length)];
                name += syllables[Math.floor(Math.random() * syllables.length)];
                if (Math.random() < 0.6) {
                    name += syllables[Math.floor(Math.random() * syllables.length)];
                }
                name += suffixes[Math.floor(Math.random() * suffixes.length)];
                return name.charAt(0).toUpperCase() + name.slice(1);
            }
        }
        
        function getComposition() {
            let planetType = rollPercentile();
            if (planetType <= 40) return "Terrestrial (Earth-like)";
            else if (planetType <= 60) return "Igneous (Fire-based)";
            else if (planetType <= 80) return "Gaseous (Air-dominant)";
            else if (planetType <= 99) return "Aqueous (Water-world)";
            else return "Biosphere (Living planet)";
        }
        
        function getDivineOrigin() {
            let godsNature = rollPercentile();
            if (godsNature <= 20) return "Product of natural evolution or cosmic event";
            else if (godsNature <= 35) return "Created by a single, omnipotent deity";
            else if (godsNature <= 55) return "Shaped by a pantheon of domain-specific gods";
            else if (godsNature <= 75) return "Forged through the combined efforts of multiple pantheons";
            else if (godsNature <= 95) return "Manifestation of a cosmic life force";
            else return "Artificial construct of mortal origin";
        }
        
        function getInhabitants() {
            let lifeType = rollPercentile();
            if (lifeType <= 70) {
                return "Exclusively non-sentient fauna";
            } else {
                if (lifeType <= 80) return "Diverse ecosystem including sentient races";
                else if (lifeType <= 85) {
                    let humanoidType = ["Dragonborn", "Dwarven", "Elven", "Gnomish", "Halfling", "Orcish", "Tiefling"][Math.floor(Math.random() * 7)];
                    return `Predominantly ${humanoidType} civilization with various fauna`;
                }
                else if (lifeType <= 90) return "Wide array of core D&D races (excluding half-breeds)";
                else if (lifeType <= 95) return "Comprehensive spectrum of D&D races, including hybrid species";
                else if (lifeType <= 99) {
                    let demiHumanType = ["Dragonborn", "Dwarven", "Elven", "Gnomish", "Halfling", "Orcish", "Tiefling"][Math.floor(Math.random() * 7)];
                    return `Human-${demiHumanType} co-dominant societies`;
                }
                else return "Melting pot of mortal, monstrous, and planar beings";
            }
        }

        function getShape() {
            let shape = rollPercentile();
            if (shape <= 5) return "Amorphous (constantly shifting form)";
            else if (shape <= 15) return "Belt (ring of planetary matter)";
            else if (shape <= 20) return "Cluster (group of closely orbiting bodies)";
            else if (shape <= 65) return "Spherical (classic planet shape)";
            else if (shape <= 70) return "Cubic (defying conventional physics)";
            else if (shape <= 90) return "Flatworld (disc-shaped planet)";
            else if (shape <= 95) return "Elliptical (elongated sphere)";
            else if (shape <= 99) return "Regular polyhedron (geometrically perfect)";
            else return "Irregular (unique, asymmetrical form)";
        }

        function getMagic() {
            let magic = rollPercentile();
            if (magic <= 15) return "Nonexistent (magic-dead world)";
            else if (magic <= 25) return "Mythical (magic is legend, rarely seen)";
            else if (magic <= 40) return "Rare (few practitioners of the arcane arts)";
            else if (magic <= 55) return "Uncommon (magic exists but isn't everyday)";
            else if (magic <= 75) return "Common (magic is a regular part of life)";
            else if (magic <= 90) return "Ubiquitous (magic infuses every aspect of society)";
            else if (magic <= 99) return "Technomantic (magic and technology are inseparable)";
            else return "Chaotic (unpredictable, reality-warping magic)";
        }

        function getTech() {
            let tech = rollPercentile();
            if (tech <= 10) return "Stone Age (basic tools and simple machines)";
            else if (tech <= 20) return "Relics-based (advanced tech exists but is poorly understood)";
            else if (tech <= 50) return "Medieval (comparable to Earth's Middle Ages)";
            else if (tech <= 70) return "Industrial (steam power and early machinery)";
            else if (tech <= 90) return "Early Modern (basic electricity and combustion engines)";
            else return "Futuristic (highly advanced technology)";
        }

        function getGovernment() {
            let government = rollPercentile();
            if (government <= 15) return "Anarchic (no centralized authority)";
            else if (government <= 30) return "Tribal (clan or family-based leadership)";
            else if (government <= 45) return "Feudal (hierarchical noble class system)";
            else if (government <= 60) return "Monarchy (rule by a single sovereign)";
            else if (government <= 75) return "Theocracy (religious leadership)";
            else if (government <= 85) return "Oligarchy (rule by a privileged few)";
            else if (government <= 90) return "Democracy (power vested in the populace)";
            else if (government <= 95) return "Republic (elected representatives govern)";
            else if (government <= 99) return "Technocracy (rule by scientific/technological elite)";
            else return "Utopia (perfect society, possibly illusory)";
        }

        function getDivineInvolvement() {
            let godsIntervention = rollPercentile();
            if (godsIntervention <= 20) return "Indifferent (gods are distant and uninvolved)";
            else if (godsIntervention <= 35) return "Subtle (divine power manifests only through clerics)";
            else if (godsIntervention <= 55) return "Mysterious (gods work in enigmatic ways)";
            else if (godsIntervention <= 75) return "Active (deities maintain close ties with followers)";
            else if (godsIntervention <= 95) return "Manifest (gods regularly appear among mortals)";
            else if (godsIntervention <= 99) return "Cataclysmic (divine interventions reshape reality)";
            else return "Absent (the gods are dead or have abandoned this world)";
        }

        function generateSVG(primaryType, planetCount, planets) {
            const svgNS = "http://www.w3.org/2000/svg";
            const svg = document.createElementNS(svgNS, "svg");
            svg.setAttribute("width", "100%");
            svg.setAttribute("height", "100%");
            svg.setAttribute("viewBox", "-300 -300 600 600");

            // Create a background
            const background = document.createElementNS(svgNS, "rect");
            background.setAttribute("x", "-300");
            background.setAttribute("y", "-300");
            background.setAttribute("width", "600");
            background.setAttribute("height", "600");
            background.setAttribute("fill", "#0a0e17");
            svg.appendChild(background);

            // Add some stars
            for (let i = 0; i < 100; i++) {
                const star = document.createElementNS(svgNS, "circle");
                star.setAttribute("cx", Math.random() * 600 - 300);
                star.setAttribute("cy", Math.random() * 600 - 300);
                star.setAttribute("r", Math.random() * 1.5);
                star.setAttribute("fill", "#ffffff");
                svg.appendChild(star);
            }

            // Create the primary body
            const primaryBody = document.createElementNS(svgNS, "circle");
            primaryBody.setAttribute("cx", "0");
            primaryBody.setAttribute("cy", "0");
            primaryBody.setAttribute("r", "30");
            
            if (primaryType <= 70) {
                // Sun
                primaryBody.setAttribute("fill", "url(#sunGradient)");
                const sunGradient = document.createElementNS(svgNS, "radialGradient");
                sunGradient.setAttribute("id", "sunGradient");
                const stop1 = document.createElementNS(svgNS, "stop");
                stop1.setAttribute("offset", "0%");
                stop1.setAttribute("stop-color", "#ffff00");
                const stop2 = document.createElementNS(svgNS, "stop");
                stop2.setAttribute("offset", "100%");
                stop2.setAttribute("stop-color", "#ff8c00");
                sunGradient.appendChild(stop1);
                sunGradient.appendChild(stop2);
                svg.appendChild(sunGradient);
            } else if (primaryType <= 95) {
                // Planet
                primaryBody.setAttribute("fill", "#4a5d7e");
            } else if (primaryType <= 99) {
                // Empty point
                primaryBody.setAttribute("r", "5");
                primaryBody.setAttribute("fill", "#ffffff");
            } else {
                // Portal
                primaryBody.setAttribute("fill", "url(#portalGradient)");
                const portalGradient = document.createElementNS(svgNS, "radialGradient");
                portalGradient.setAttribute("id", "portalGradient");
                const stop1 = document.createElementNS(svgNS, "stop");
                stop1.setAttribute("offset", "0%");
                stop1.setAttribute("stop-color", "#800080");
                const stop2 = document.createElementNS(svgNS, "stop");
                stop2.setAttribute("offset", "100%");
                stop2.setAttribute("stop-color", "#4b0082");
                portalGradient.appendChild(stop1);
                portalGradient.appendChild(stop2);
                svg.appendChild(portalGradient);
            }
            svg.appendChild(primaryBody);

            // Create orbits and planets
            const orbitColors = ["#1a2639", "#2a3649", "#3a4659", "#4a5669", "#5a6679"];
            const planetColors = ["#8B4513", "#A52A2A", "#CD853F", "#DEB887", "#F4A460"];
            
            for (let i = 0; i < planetCount; i++) {
                const orbitRadius = 50 + i * 40;
                const orbit = document.createElementNS(svgNS, "circle");
                orbit.setAttribute("cx", "0");
                orbit.setAttribute("cy", "0");
                orbit.setAttribute("r", orbitRadius);
                orbit.setAttribute("fill", "none");
                orbit.setAttribute("stroke", orbitColors[i % orbitColors.length]);
                orbit.setAttribute("stroke-width", "1");
                svg.appendChild(orbit);

                const angle = Math.random() * Math.PI * 2;
                const x = Math.cos(angle) * orbitRadius;
                const y = Math.sin(angle) * orbitRadius;

                const planet = document.createElementNS(svgNS, "circle");
                planet.setAttribute("cx", x);
                planet.setAttribute("cy", y);
                
                // Set planet size based on size category
                let planetSize = 5; // default size
                if (planets[i].sizeCategory) {
                    const sizeCategory = planets[i].sizeCategory.charAt(0);
                    planetSize = 3 + (sizeCategory.charCodeAt(0) - 65) * 2; // A=3, B=5, C=7, etc.
                }
                planet.setAttribute("r", planetSize);
                
                planet.setAttribute("fill", planetColors[i % planetColors.length]);
                svg.appendChild(planet);

                // Add planet name
                const planetName = document.createElementNS(svgNS, "text");
                planetName.setAttribute("x", x);
                planetName.setAttribute("y", y + planetSize + 10);
                planetName.setAttribute("text-anchor", "middle");
                planetName.setAttribute("fill", "#ffffff");
                planetName.setAttribute("font-size", "8");
                planetName.textContent = planets[i].name;
                svg.appendChild(planetName);
            }

            return svg;
        }

        function generateCrystalSphere() {
            let sphereName = generateSphereName();
            let log = `Crystal Sphere Navigation Log: ${sphereName}\n`;
            log += "==============================\n\n";

            // Generate all the characteristics
            let systemType;
            if (document.getElementById('systemType').value === 'random') {
                systemType = rollPercentile();
            } else {
                systemType = document.getElementById('systemType').value === 'standard' ? 1 : 96;
            }
            let primaryType = rollPercentile();
            let planetaryMotion = rollPercentile();
            let divineOrigin = getDivineOrigin();

            // Summary paragraph
            log += "Summary:\n";
            log += `${sphereName} is a ${systemType <= 95 ? "standard" : "special"} crystal sphere. `;
            
            let primaryDescription = "";
            if (primaryType <= 70) {
                primaryDescription = "At its heart burns a fiery sun, ";
            } else if (primaryType <= 95) {
                let primaryPlanetName = generatePlanetName();
                primaryDescription = `Its primary body is a planet (${primaryPlanetName}), `;
            } else if (primaryType <= 99) {
                primaryDescription = "Uniquely, it lacks a central body, with planets orbiting an empty point, ";
            } else {
                let planeType = rollPercentile();
                let planeName = "";
                if (planeType <= 30) planeName = "the Outer Planes";
                else if (planeType <= 50) planeName = "the Plane of Elemental Fire";
                else if (planeType <= 60) planeName = "the Plane of Elemental Water";
                else if (planeType <= 70) planeName = "the Plane of Elemental Earth";
                else if (planeType <= 80) planeName = "the Plane of Elemental Air";
                else if (planeType <= 90) planeName = "the Feywild";
                else planeName = "the Shadowfell";
                primaryDescription = `At its core lies a portal to ${planeName}, `;
            }
            log += primaryDescription;
            log += `This sphere was ${divineOrigin.toLowerCase()}. `;

            let planetCount = document.getElementById('planetCount').value;
            if (!planetCount) {
                let numPlanets = rollPercentile();
                if (numPlanets <= 5) planetCount = "one";
                else if (numPlanets <= 10) planetCount = "two";
                else if (numPlanets <= 15) planetCount = "three";
                else if (numPlanets <= 20) planetCount = "four";
                else if (numPlanets <= 30) planetCount = "five";
                else if (numPlanets <= 45) planetCount = "six";
                else if (numPlanets <= 55) planetCount = "seven";
                else if (numPlanets <= 65) planetCount = "eight";
                else if (numPlanets <= 75) planetCount = "nine";
                else if (numPlanets <= 85) planetCount = "ten";
                else if (numPlanets <= 90) planetCount = rollDice(20).toString();
                else planetCount = "no major";
            }

            if (planetCount !== "no major") {
                log += `It is surrounded by ${planetCount} ${planetCount === "one" ? "planet" : "planets"}. `;
            } else {
                log += "It is filled with small planetoids and debris instead of major planets. ";
            }

            if (planetaryMotion <= 10) log += "The celestial bodies remain fixed in place.\n";
            else if (planetaryMotion <= 15) log += "Planets move randomly within the sphere.\n";
            else if (planetaryMotion <= 50) log += "All planets orbit in a clockwise direction.\n";
            else if (planetaryMotion <= 90) log += "All planets orbit in a counterclockwise direction.\n";
            else if (planetaryMotion <= 96) log += "Each planet has its own unique orbital pattern.\n";
            else log += "Fantastically, the planets are carried on the backs of colossal world-creatures.\n";

            log += "\nKey Characteristics:\n";
            log += `â€¢ System Type: ${systemType <= 95 ? "Standard" : "Special"}\n`;
            log += `â€¢ Primary Type: ${primaryDescription.trim()}\n`;
            log += `â€¢ Divine Origin: ${divineOrigin} <button class="reroll-btn" onclick="rerollDivineOrigin()">ðŸŽ²</button>\n`;
            log += `â€¢ Number of Planets: ${planetCount.charAt(0).toUpperCase() + planetCount.slice(1)}\n`;
            
            // Planetary Motion details
            log += "â€¢ Planetary Motion: ";
            if (planetaryMotion <= 10) log += "Fixed planets\n";
            else if (planetaryMotion <= 15) log += "Random movement within sphere\n";
            else if (planetaryMotion <= 50) log += "Clockwise orbits\n";
            else if (planetaryMotion <= 90) log += "Counterclockwise orbits\n";
            else if (planetaryMotion <= 96) log += "Varied individual orbits\n";
            else log += "Carried by world-creatures\n";

            // Continue with planet generation if there are planets
            let planets = [];
            if (planetCount !== "no major") {
                log += "\nPlanetary Details:\n";
                
                let actualPlanetCount = parseInt(planetCount) || {"one": 1, "two": 2, "three": 3, "four": 4, "five": 5, "six": 6, "seven": 7, "eight": 8, "nine": 9, "ten": 10}[planetCount];
                
                for (let i = 1; i <= actualPlanetCount; i++) {
                    let planetName = generatePlanetName();
                    log += `\nPlanet ${i}: <input type="text" class="planet-name" value="${planetName}">\n`;
                    
                    // Planet Type
                    let composition = getComposition();
                    log += `â€¢ Composition: <span id='composition-${i}'>${composition}</span> `;
                    log += `<button class="reroll-btn" onclick="rerollComposition(${i})">ðŸŽ²</button>\n`;

                    // Planet Size
                    let planetSize = rollPercentile();
                    let sizeTable, sizeCategory, actualSize;
                    if (['Igneous', 'Gaseous'].includes(composition)) {
                        sizeTable = [2, 5, 10, 20, 35, 50, 70, 85, 95, 100];
                        sizeCategory = String.fromCharCode(65 + sizeTable.findIndex(v => planetSize <= v));
                        actualSize = Math.floor(Math.random() * (10 ** (sizeCategory.charCodeAt(0) - 64)) + 1);
                    } else {
                        sizeTable = [5, 10, 20, 40, 60, 80, 90, 100];
                        sizeCategory = String.fromCharCode(65 + sizeTable.findIndex(v => planetSize <= v));
                        actualSize = Math.floor(Math.random() * (40000 - 10) + 10); // Range from 10 to 40,000 miles
                    }
                    log += `â€¢ Diameter: <span id='size-${i}'>${actualSize.toLocaleString()} miles (Size category ${sizeCategory})</span> `;
                    log += `<button class="reroll-btn" onclick="rerollSize(${i})">ðŸŽ²</button>\n`;

                    // Shape
                    let shape = getShape();
                    log += `â€¢ Morphology: <span id='shape-${i}'>${shape}</span> `;
                    log += `<button class="reroll-btn" onclick="rerollShape(${i})">ðŸŽ²</button>\n`;

                    // Life on Planets
                    let inhabitants = getInhabitants();
                    log += `â€¢ Inhabitants: <span id='inhabitants-${i}'>${inhabitants}</span> `;
                    log += `<button class="reroll-btn" onclick="rerollInhabitants(${i})">ðŸŽ²</button>\n`;

                    if (inhabitants !== "Exclusively non-sentient fauna") {
                        // Society details for sentient life
                        log += "  Societal Characteristics:\n";

                        // Magic in the World
                        let magic = getMagic();
                        log += `  â€¢ Arcane Presence: <span id='magic-${i}'>${magic}</span> `;
                        log += `<button class="reroll-btn" onclick="rerollMagic(${i})">ðŸŽ²</button>\n`;

                        // Technology in the World
                        let tech = getTech();
                        log += `  â€¢ Technological Level: <span id='tech-${i}'>${tech}</span> `;
                        log += `<button class="reroll-btn" onclick="rerollTech(${i})">ðŸŽ²</button>\n`;

                        // Governments in the World
                        let government = getGovernment();
                        log += `  â€¢ Political Structure: <span id='government-${i}'>${government}</span> `;
                        log += `<button class="reroll-btn" onclick="rerollGovernment(${i})">ðŸŽ²</button>\n`;

                        // The Gods Intervention
                        let divineInvolvement = getDivineInvolvement();
                        log += `  â€¢ Divine Involvement: <span id='divine-involvement-${i}'>${divineInvolvement}</span> `;
                        log += `<button class="reroll-btn" onclick="rerollDivineInvolvement(${i})">ðŸŽ²</button>\n`;
                    }

                    planets.push({
                        name: planetName,
                        composition: composition,
                        sizeCategory: sizeCategory,
                        shape: shape,
                        inhabitants: inhabitants
                    });
                }
            }

            // Generate SVG
            const svg = generateSVG(primaryType, planets.length, planets);
            document.getElementById('svgContainer').innerHTML = '';
            document.getElementById('svgContainer').appendChild(svg);

            return log;
        }

        function rerollComposition(planetNum) {
            document.getElementById('composition-' + planetNum).textContent = getComposition();
        }

        function rerollSize(planetNum) {
            let planetSize = rollPercentile();
            let sizeTable, sizeCategory, actualSize;
            if (['Igneous', 'Gaseous'].includes(document.getElementById('composition-' + planetNum).textContent)) {
                sizeTable = [2, 5, 10, 20, 35, 50, 70, 85, 95, 100];
                sizeCategory = String.fromCharCode(65 + sizeTable.findIndex(v => planetSize <= v));
                actualSize = Math.floor(Math.random() * (10 ** (sizeCategory.charCodeAt(0) - 64)) + 1);
            } else {
                sizeTable = [5, 10, 20, 40, 60, 80, 90, 100];
                sizeCategory = String.fromCharCode(65 + sizeTable.findIndex(v => planetSize <= v));
                actualSize = Math.floor(Math.random() * (40000 - 10) + 10); // Range from 10 to 40,000 miles
            }
            document.getElementById('size-' + planetNum).textContent = `${actualSize.toLocaleString()} miles (Size category ${sizeCategory})`;
        }

        function rerollShape(planetNum) {
            document.getElementById('shape-' + planetNum).textContent = getShape();
        }

        function rerollInhabitants(planetNum) {
            let newInhabitants = getInhabitants();
            document.getElementById('inhabitants-' + planetNum).textContent = newInhabitants;
            
            let societalCharacteristics = document.getElementById('societal-characteristics-' + planetNum);
            if (!societalCharacteristics) {
                societalCharacteristics = document.createElement('div');
                societalCharacteristics.id = 'societal-characteristics-' + planetNum;
                document.getElementById('inhabitants-' + planetNum).parentNode.appendChild(societalCharacteristics);
            }
            
            if (newInhabitants !== "Exclusively non-sentient fauna"){
                societalCharacteristics.innerHTML = `
                    Societal Characteristics:<br>
                    â€¢ Arcane Presence: <span id='magic-${planetNum}'>${getMagic()}</span> 
                    <button class="reroll-btn" onclick="rerollMagic(${planetNum})">ðŸŽ²</button><br>
                    â€¢ Technological Level: <span id='tech-${planetNum}'>${getTech()}</span> 
                    <button class="reroll-btn" onclick="rerollTech(${planetNum})">ðŸŽ²</button><br>
                    â€¢ Political Structure: <span id='government-${planetNum}'>${getGovernment()}</span> 
                    <button class="reroll-btn" onclick="rerollGovernment(${planetNum})">ðŸŽ²</button><br>
                    â€¢ Divine Involvement: <span id='divine-involvement-${planetNum}'>${getDivineInvolvement()}</span> 
                    <button class="reroll-btn" onclick="rerollDivineInvolvement(${planetNum})">ðŸŽ²</button>
                `;
            } else {
                societalCharacteristics.innerHTML = '';
            }
        }

        function rerollMagic(planetNum) {
            document.getElementById('magic-' + planetNum).textContent = getMagic();
        }

        function rerollTech(planetNum) {
            document.getElementById('tech-' + planetNum).textContent = getTech();
        }

        function rerollGovernment(planetNum) {
            document.getElementById('government-' + planetNum).textContent = getGovernment();
        }

        function rerollDivineInvolvement(planetNum) {
            document.getElementById('divine-involvement-' + planetNum).textContent = getDivineInvolvement();
        }

        function rerollDivineOrigin() {
            let newDivineOrigin = getDivineOrigin();
            let output = document.getElementById('output');
            let content = output.innerHTML;
            
            // Update in Key Characteristics
            let regex = /(â€¢ Divine Origin: )([^<]+)/;
            content = content.replace(regex, `$1${newDivineOrigin}`);
            
            // Update in summary
            regex = /(This sphere was )([^.]+)\./;
            content = content.replace(regex, `$1${newDivineOrigin.toLowerCase()}.`);
            
            output.innerHTML = content;
        }

        function getPlainText() {
            const output = document.getElementById('output');
            return output.innerText;
        }

        function copyToClipboard() {
            const text = getPlainText();
            navigator.clipboard.writeText(text).then(function() {
                alert('Copied to clipboard!');
            }, function(err) {
                console.error('Could not copy text: ', err);
            });
        }

        function downloadSphereTxt() {
            const text = getPlainText();
            const filename = 'crystal_sphere.txt';
            const element = document.createElement('a');
            element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
            element.setAttribute('download', filename);
            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        }

        function addStars() {
            const container = document.body;
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.top = `${Math.random() * 100}%`;
                star.style.left = `${Math.random() * 100}%`;
                star.style.animationDelay = `${Math.random() * 5}s`;
                container.appendChild(star);
            }
        }

        document.getElementById('generate').addEventListener('click', function() {
            const output = generateCrystalSphere();
            document.getElementById('output').innerHTML = output;
            
            // Enable the copy and download buttons
            document.getElementById('copy').disabled = false;
            document.getElementById('download').disabled = false;
        });

        document.getElementById('copy').addEventListener('click', copyToClipboard);
        document.getElementById('download').addEventListener('click', downloadSphereTxt);

        // Initialize copy and download buttons as disabled
        document.getElementById('copy').disabled = true;
        document.getElementById('download').disabled = true;

        // Call this function when the page loads
        window.onload = addStars;
    </script>
</body>
</html>



